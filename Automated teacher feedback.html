<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™å¸«è©•èªç”¢ç”Ÿç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Sans TC", "Microsoft JhengHei";
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            background: linear-gradient(135deg, #9370DB 0%, #8A2BE2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .input-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .student-name-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .student-name-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .evaluation-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .evaluation-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .evaluation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .evaluation-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .score-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            min-width: 40px;
            text-align: center;
        }

        .score-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .score-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            min-width: 45px;
        }

        .score-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .score-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .score-btn.no-score {
            background: #6c757d;
            color: white;
            border-color: #6c757d;
        }

        .example-input-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .example-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: #555;
            margin-bottom: 8px;
        }

        .example-input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .example-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .example-hint {
            display: block;
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
        }

        .tone-selection, .style-selection {
            margin-top: 30px;
            padding: 25px;
            background: #f0f4ff;
            border-radius: 8px;
            border: 2px solid #e0e6ff;
        }

        .tone-selection {
            background: #f0f8ff;
            border-color: #b3d9ff;
        }

        .tone-label, .style-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: block;
        }

        .tone-options, .style-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .tone-option, .style-option {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .tone-option .tone-content,
        .style-option .style-content {
            flex: 1;
        }

        .tone-option:hover, .style-option:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }

        .tone-option input[type="radio"], .style-option input[type="radio"] {
            margin-right: 12px;
            margin-top: 2px;
            cursor: pointer;
        }

        .tone-option input[type="radio"]:checked + .tone-content .tone-name,
        .style-option input[type="radio"]:checked + .style-content .style-name {
            color: #667eea;
            font-weight: 600;
        }

        .tone-option input[type="radio"]:checked + .tone-content .tone-desc,
        .style-option input[type="radio"]:checked + .style-content .style-desc {
            color: #667eea;
        }

        .tone-name, .style-name {
            display: block;
            font-weight: 500;
            margin-bottom: 4px;
            color: #333;
        }

        .tone-desc, .style-desc {
            display: block;
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .generate-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .result-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .result-section.show {
            display: block;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .copy-btn {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .copy-btn.copied {
            background: #17a2b8;
        }

        .comment-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #333;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-bottom: 30px;
        }

        .radar-chart-section {
            margin-top: 20px;
        }

        .radar-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .radar-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #9370DB;
        }

        .reset-btn {
            padding: 10px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .reset-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        /* ç‰ˆæœ¬é¸æ“‡æ¨£å¼ */
        .version-selection {
            margin: 30px 0;
            padding: 25px;
            background: #f0f8ff;
            border-radius: 8px;
            border: 2px solid #b3d9ff;
        }

        .version-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: block;
        }

        .version-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .version-option {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .version-option:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }

        .version-option input[type="radio"] {
            margin-right: 12px;
            margin-top: 2px;
            cursor: pointer;
        }

        .version-option input[type="radio"]:checked + .version-content .version-name {
            color: #667eea;
            font-weight: 600;
        }

        .version-option input[type="radio"]:checked + .version-content .version-desc {
            color: #667eea;
        }

        .version-content {
            flex: 1;
        }

        .version-name {
            display: block;
            font-weight: 500;
            margin-bottom: 4px;
            color: #333;
        }

        .version-desc {
            display: block;
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .version-section {
            margin-top: 20px;
        }

        /* å››å­—æˆèªç‰ˆæœ¬æ¨£å¼ */
        .idiom-categories {
            margin-bottom: 30px;
        }

        .categories-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .category-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .category-item:hover {
            border-color: #9370DB;
            box-shadow: 0 4px 12px rgba(147, 112, 219, 0.1);
        }

        .category-item h4 {
            color: #9370DB;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .subcategories {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .subcategories label {
            display: flex;
            align-items: center;
            font-size: 0.95rem;
            color: #555;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        .subcategories label:hover {
            background-color: rgba(147, 112, 219, 0.1);
        }

        .subcategories input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }

        .subcategories input[type="checkbox"]:checked + span {
            color: #9370DB;
            font-weight: 500;
        }

        /* ç”Ÿæˆçš„æˆèªçµæœæ¨£å¼ */
        .idiom-result {
            background: #f0f4ff;
            border: 2px solid #9370DB;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .idiom-result h4 {
            color: #9370DB;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .idiom-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .idiom-item {
            background: white;
            border: 1px solid #9370DB;
            border-radius: 6px;
            padding: 8px 12px;
            color: #9370DB;
            font-weight: 500;
            font-size: 0.95rem;
        }

        /* æª”æ¡ˆä¸Šå‚³å€åŸŸæ¨£å¼ */
        .file-upload-section {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 10px;
            border: 2px dashed #9370DB;
            margin-bottom: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .file-upload-section:hover {
            background: #f0f4ff;
            border-color: #764ba2;
        }

        .file-upload-section.dragover {
            background: #e8f2ff;
            border-color: #667eea;
        }

        .upload-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #9370DB;
            margin-bottom: 15px;
        }

        .upload-description {
            color: #666;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-btn {
            padding: 12px 24px;
            background: #9370DB;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input-btn:hover {
            background: #764ba2;
            transform: translateY(-1px);
        }

        .file-info {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .file-details {
            font-size: 0.9rem;
            color: #666;
        }

        /* å­¸ç”Ÿåˆ—è¡¨å€åŸŸæ¨£å¼ */
        .student-list-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            display: none;
        }

        .student-list-section.show {
            display: block;
        }

        .student-list-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .student-count {
            font-size: 1rem;
            color: #9370DB;
            font-weight: normal;
        }

        /* å­¸ç”Ÿé¸æ“‡å™¨æ¨£å¼ */
        .student-selector-container {
            margin-bottom: 25px;
        }

        .selector-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .selector-wrapper {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .student-selector {
            flex: 1;
            min-width: 250px;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .student-selector:focus {
            outline: none;
            border-color: #9370DB;
            box-shadow: 0 0 0 3px rgba(147, 112, 219, 0.1);
        }

        .student-selector option {
            padding: 8px;
            font-size: 14px;
        }

        .student-selector option[data-status="unrated"] {
            color: #dc3545;
        }

        .student-selector option[data-status="rated"] {
            color: #ffc107;
        }

        .student-selector option[data-status="completed"] {
            color: #28a745;
        }

        .student-selector option[data-status="active"] {
            color: #007bff;
            font-weight: bold;
        }

        .selector-search {
            flex: 1;
            min-width: 200px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #9370DB;
            box-shadow: 0 0 0 3px rgba(147, 112, 219, 0.1);
        }

        /* å­¸ç”Ÿç‹€æ…‹çµ±è¨ˆæ¨£å¼ */
        .student-stats {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            background: white;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            font-size: 1.2rem;
            margin-bottom: 8px;
            display: block;
        }

        .stat-label {
            display: block;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-count {
            display: block;
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .current-student-indicator {
            background: #f0f4ff;
            border: 2px solid #9370DB;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .current-student-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #9370DB;
        }

        .batch-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .batch-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .batch-btn.export {
            background: #28a745;
            color: white;
        }

        .batch-btn.export:hover {
            background: #218838;
        }

        .batch-btn.overview {
            background: #17a2b8;
            color: white;
        }

        .batch-btn.overview:hover {
            background: #138496;
        }

        /* æ‰¹é‡çµæœç¸½è¦½æ¨£å¼ */
        .batch-overview-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            display: none;
        }

        .batch-overview-section.show {
            display: block;
        }

        .overview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .overview-table th,
        .overview-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .overview-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .overview-table tr:hover {
            background: #f8f9fa;
        }

        .overview-table td.student-name-cell {
            font-weight: 500;
            color: #9370DB;
            cursor: pointer;
        }

        .overview-table td.student-name-cell:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .score-cell {
            text-align: center;
            font-weight: 500;
        }

        .score-cell.scored {
            color: #28a745;
        }

        .score-cell.unscored {
            color: #dc3545;
        }

        /* è©•èªå„²å­˜æŒ‰éˆ•æ¨£å¼ */
        .save-comment-btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .save-comment-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .save-comment-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .comment-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-weight: 500;
        }

        .comment-status.saved {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .comment-status.unsaved {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .comment-metadata {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
            text-align: center;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .selector-wrapper {
                flex-direction: column;
                gap: 10px;
            }
            
            .student-selector {
                min-width: auto;
            }
            
            .selector-search {
                min-width: auto;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .style-options {
                justify-content: center;
            }
            
            .style-option {
                flex-direction: column;
                text-align: center;
            }
            
            .style-option input[type="radio"] {
                margin: 0 auto 8px auto;
            }
            
            .score-buttons {
                justify-content: center;
            }
            
            .result-header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>æ•™å¸«è©•èªç”¢ç”Ÿç³»çµ±</h1>
            <p>é€éå…­å€‹å‘åº¦çš„è©•åˆ†ï¼Œå¿«é€Ÿç”Ÿæˆæ­£å‘é¼“å‹µçš„å­¸ç”Ÿè©•èª</p>
        </div>

        <!-- æª”æ¡ˆä¸Šå‚³å€åŸŸ -->
        <div class="file-upload-section" id="fileUploadSection">
            <h2 class="upload-title">åŒ¯å…¥å­¸ç”Ÿåå–®</h2>
            <p class="upload-description">æ”¯æ´ CSVã€XLSã€XLSX æ ¼å¼æª”æ¡ˆï¼Œç³»çµ±æœƒè‡ªå‹•è®€å–ç¬¬ä¸€åˆ—ä½œç‚ºå­¸ç”Ÿå§“å</p>
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" class="file-input" accept=".csv,.xls,.xlsx" onchange="handleFileUpload(event)">
                <button class="file-input-btn">é¸æ“‡æª”æ¡ˆ</button>
            </div>
            <div class="file-info" id="fileInfo">
                <div class="file-name" id="fileName"></div>
                <div class="file-details" id="fileDetails"></div>
            </div>
        </div>

        <!-- å­¸ç”Ÿåˆ—è¡¨å€åŸŸ -->
        <div class="student-list-section" id="studentListSection">
            <div class="student-list-title">
                å­¸ç”Ÿåå–®
                <span class="student-count" id="studentCount">å…± 0 ä½å­¸ç”Ÿ</span>
            </div>
            
            <!-- å­¸ç”Ÿé¸æ“‡ä¸‹æ‹‰é¸å–® -->
            <div class="student-selector-container">
                <label for="studentSelector" class="selector-label">é¸æ“‡å­¸ç”Ÿé€²è¡Œè©•åˆ†ï¼š</label>
                <div class="selector-wrapper">
                    <select id="studentSelector" class="student-selector" onchange="handleStudentSelection(this.value)">
                        <option value="">-- è«‹é¸æ“‡å­¸ç”Ÿ --</option>
                    </select>
                    <div class="selector-search">
                        <input type="text" id="studentSearch" class="search-input" placeholder="æœå°‹å­¸ç”Ÿå§“å..." onkeyup="filterStudents(this.value)" onkeydown="handleSearchKeydown(event)">
                    </div>
                </div>
            </div>
            
            <!-- å­¸ç”Ÿç‹€æ…‹çµ±è¨ˆ -->
            <div class="student-stats" id="studentStats">
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-icon">ğŸ”´</span>
                        <span class="stat-label">æœªè©•åˆ†</span>
                        <span class="stat-count" id="unratedCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">ğŸŸ¡</span>
                        <span class="stat-label">å·²è©•åˆ†</span>
                        <span class="stat-count" id="ratedCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">ğŸŸ¢</span>
                        <span class="stat-label">å·²å®Œæˆ</span>
                        <span class="stat-count" id="completedCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">ğŸ“Š</span>
                        <span class="stat-label">å®Œæˆç‡</span>
                        <span class="stat-count" id="completionRate">0%</span>
                    </div>
                </div>
            </div>
            
            <div class="batch-actions">
                <button class="batch-btn overview" onclick="toggleBatchOverview()">æŸ¥çœ‹ç¸½è¦½</button>
                <button class="batch-btn export" onclick="exportResults()">åŒ¯å‡ºçµæœ</button>
            </div>
        </div>

        <!-- æ‰¹é‡çµæœç¸½è¦½å€åŸŸ -->
        <div class="batch-overview-section" id="batchOverviewSection">
            <h2 class="result-title">å­¸ç”Ÿè©•åˆ†ç¸½è¦½</h2>
            <table class="overview-table" id="overviewTable">
                <thead>
                    <tr>
                        <th>å­¸ç”Ÿå§“å</th>
                        <th>ä¸Šèª²æ…‹åº¦</th>
                        <th>è€ƒè©¦åˆ†æ•¸</th>
                        <th>ç­†è¨˜åˆ†æ•¸</th>
                        <th>åŒå„•é—œä¿‚</th>
                        <th>è‡ªä¸»å­¸ç¿’</th>
                        <th>ç”Ÿæ´»å¸¸è¦</th>
                        <th>è©•èªç‹€æ…‹</th>
                        <th>è©•èªé¡å‹</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- è³‡æ–™å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>

        <div class="input-section">
            <!-- ç•¶å‰å­¸ç”ŸæŒ‡ç¤ºå™¨ -->
            <div class="current-student-indicator" id="currentStudentIndicator" style="display: none;">
                <div>æ­£åœ¨è©•åˆ†ï¼š<span class="current-student-name" id="currentStudentName"></span></div>
            </div>
            
            <div class="form-group">
                <label for="studentName">å­¸ç”Ÿå§“å</label>
                <input type="text" id="studentName" class="student-name-input" placeholder="è«‹è¼¸å…¥å­¸ç”Ÿå§“åæˆ–å¾ä¸Šæ–¹å­¸ç”Ÿåˆ—è¡¨é¸æ“‡">
            </div>

            <div class="version-selection">
                <label class="version-label">é¸æ“‡è©•èªç‰ˆæœ¬</label>
                <div class="version-options">
                    <label class="version-option">
                        <input type="radio" name="commentVersion" value="scoring" checked>
                        <div class="version-content">
                            <span class="version-name">å…­å‘åº¦è©•åˆ†ç‰ˆæœ¬</span>
                            <span class="version-desc">é€éå…­å€‹å‘åº¦è©•åˆ†ç”Ÿæˆè©³ç´°è©•èª</span>
                        </div>
                    </label>
                    <label class="version-option">
                        <input type="radio" name="commentVersion" value="idioms">
                        <div class="version-content">
                            <span class="version-name">å››å­—æˆèªç‰ˆæœ¬</span>
                            <span class="version-desc">é¸æ“‡ä¸åŒé¡åˆ¥ï¼Œéš¨æ©Ÿç”Ÿæˆå››å­—æˆèªè©•èª</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- å…­å‘åº¦è©•åˆ†ç‰ˆæœ¬ç•Œé¢ -->
            <div id="scoringSection" class="version-section">
                <div id="evaluationItems">
                    <!-- è©•é‡é …ç›®å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>

                <div class="tone-selection">
                    <label class="tone-label">é¸æ“‡è©•èªèªæ°£</label>
                    <div class="tone-options">
                        <label class="tone-option">
                            <input type="radio" name="commentTone" value="encouraging" checked>
                            <div class="tone-content">
                                <span class="tone-name">ç©æ¥µé¼“å‹µ</span>
                                <span class="tone-desc">å……æ»¿æ­£èƒ½é‡çš„é¼“å‹µæ€§èªå¥ï¼Œé©åˆæ—¥å¸¸æ¿€å‹µ</span>
                            </div>
                        </label>
                        <label class="tone-option">
                            <input type="radio" name="commentTone" value="neutral">
                            <div class="tone-content">
                                <span class="tone-name">ä¸­æ€§è©•åƒ¹</span>
                                <span class="tone-desc">å®¢è§€äº‹å¯¦çš„è©•åƒ¹æè¿°ï¼Œé©åˆæ­£å¼è©•é‡</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="style-selection">
                    <label class="style-label">é¸æ“‡è©•èªé¢¨æ ¼</label>
                    <div class="style-options">
                        <label class="style-option">
                            <input type="radio" name="commentStyle" value="style1" checked>
                            <div class="style-content">
                                <span class="style-name">å¤šæ¨£åŒ–éŠœæ¥è©</span>
                                <span class="style-desc">ä½¿ç”¨ã€Œåœ¨...æ–¹é¢ã€ã€ã€Œ...çš„è¡¨ç¾ã€ç­‰å¤šæ¨£åŒ–éŠœæ¥</span>
                            </div>
                        </label>
                        <label class="style-option">
                            <input type="radio" name="commentStyle" value="style2">
                            <div class="style-content">
                                <span class="style-name">è‡ªç„¶èªå¥èåˆ</span>
                                <span class="style-desc">ä¸æå‘åº¦åç¨±ï¼Œç›´æ¥æè¿°è¡¨ç¾</span>
                            </div>
                        </label>
                        <label class="style-option">
                            <input type="radio" name="commentStyle" value="style3">
                            <div class="style-content">
                                <span class="style-name">é‚è¼¯åˆ†çµ„é€£æ¥</span>
                                <span class="style-desc">å°‡ç›¸é—œå‘åº¦åˆ†çµ„ï¼Œç”¨é‚è¼¯é€£æ¥è©ä¸²è¯</span>
                            </div>
                        </label>
                    </div>
                </div>

                <button class="generate-btn" onclick="generateComment()">ç”Ÿæˆè©•èª</button>
            </div>

            <!-- å››å­—æˆèªç‰ˆæœ¬ç•Œé¢ -->
            <div id="idiomsSection" class="version-section" style="display: none;">
                <div class="idiom-categories">
                    <h3 class="categories-title">é¸æ“‡è©•èªé¡åˆ¥</h3>
                    <div class="categories-grid">
                        <div class="category-item" data-category="attitude">
                            <h4>å­¸ç¿’æ…‹åº¦é¡</h4>
                            <div class="subcategories">
                                <label><input type="checkbox" data-subcategory="positive"><span>ç©æ¥µæ­£é¢</span></label>
                                <label><input type="checkbox" data-subcategory="method"><span>å­¸ç¿’æ–¹æ³•</span></label>
                            </div>
                        </div>
                        <div class="category-item" data-category="character">
                            <h4>å“æ ¼ä¿®é¤Šé¡</h4>
                            <div class="subcategories">
                                <label><input type="checkbox" data-subcategory="moral"><span>å“å¾·é«˜å°š</span></label>
                                <label><input type="checkbox" data-subcategory="honest"><span>èª å¯¦å®ˆä¿¡</span></label>
                                <label><input type="checkbox" data-subcategory="humble"><span>è¬™éœæœ‰ç¦®</span></label>
                            </div>
                        </div>
                        <div class="category-item" data-category="relationship">
                            <h4>äººéš›é—œä¿‚é¡</h4>
                            <div class="subcategories">
                                <label><input type="checkbox" data-subcategory="teamwork"><span>åœ˜éšŠåˆä½œ</span></label>
                                <label><input type="checkbox" data-subcategory="leadership"><span>é ˜å°èƒ½åŠ›</span></label>
                            </div>
                        </div>
                        <div class="category-item" data-category="personality">
                            <h4>æ€§æ ¼ç‰¹è³ªé¡</h4>
                            <div class="subcategories">
                                <label><input type="checkbox" data-subcategory="perseverance"><span>å …æ¯…ä¸æ‹”</span></label>
                                <label><input type="checkbox" data-subcategory="cheerful"><span>é–‹æœ—æ´»æ½‘</span></label>
                                <label><input type="checkbox" data-subcategory="steady"><span>ç©©é‡å¯é </span></label>
                            </div>
                        </div>
                        <div class="category-item" data-category="ability">
                            <h4>èƒ½åŠ›è¡¨ç¾é¡</h4>
                            <div class="subcategories">
                                <label><input type="checkbox" data-subcategory="academic"><span>å­¸æ¥­æˆå°±</span></label>
                                <label><input type="checkbox" data-subcategory="diverse"><span>å¤šå…ƒç™¼å±•</span></label>
                                <label><input type="checkbox" data-subcategory="creative"><span>å‰µæ–°æ€ç¶­</span></label>
                            </div>
                        </div>
                        <div class="category-item" data-category="progress">
                            <h4>é€²æ­¥é¼“å‹µé¡</h4>
                            <div class="subcategories">
                                <label><input type="checkbox" data-subcategory="improve"><span>æŒçºŒæ”¹é€²</span></label>
                                <label><input type="checkbox" data-subcategory="potential"><span>æ½›åŠ›ç™¼æ®</span></label>
                            </div>
                        </div>
                        <div class="category-item" data-category="special">
                            <h4>ç‰¹æ®Šè¡¨ç¾é¡</h4>
                            <div class="subcategories">
                                <label><input type="checkbox" data-subcategory="art"><span>è—è¡“æ‰èƒ½</span></label>
                                <label><input type="checkbox" data-subcategory="sports"><span>é«”è‚²å°ˆé•·</span></label>
                                <label><input type="checkbox" data-subcategory="service"><span>æœå‹™è²¢ç»</span></label>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="generate-btn" onclick="generateIdiomComment()">ç”Ÿæˆå››å­—æˆèªè©•èª</button>
            </div>
        </div>

        <div class="result-section" id="resultSection">
            <div class="result-header">
                <h2 class="result-title">ç”Ÿæˆçš„è©•èª</h2>
                <div>
                    <button class="copy-btn" onclick="copyComment()">è¤‡è£½è©•èª</button>
                    <button class="save-comment-btn" id="saveCommentBtn" onclick="saveCurrentComment()">å„²å­˜è©•èª</button>
                    <button class="copy-btn" id="regenerateIdiomBtn" onclick="regenerateIdioms()" style="display: none; background: #fd7e14;">é‡æ–°ç”Ÿæˆ</button>
                    <button class="reset-btn" onclick="resetForm()">é‡æ–°é–‹å§‹</button>
                </div>
            </div>
            <div class="comment-text" id="commentText"></div>
            
            <!-- è©•èªç‹€æ…‹é¡¯ç¤º -->
            <div class="comment-status" id="commentStatus" style="display: none;">
                <span id="commentStatusText"></span>
                <div class="comment-metadata" id="commentMetadata"></div>
            </div>
            
            <div class="radar-chart-section">
                <h3 class="radar-title">èƒ½åŠ›é›·é”åœ–</h3>
                <div class="radar-container">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å››å­—æˆèªè³‡æ–™
        const idiomData = {
            attitude: {
                positive: [
                    'å‹¤å‹‰å‘å­¸', 'ç”¨åŠŸèªçœŸ', 'å­¸ç¿’èªçœŸ', 'ç”¨åŠŸåŠªåŠ›', 'å‹¤å­¸ä¸æ‡ˆ',
                    'å­¸è€Œæ™‚ç¿’', 'å­œå­œä¸å€¦', 'å¥½å­¸ä¸å€¦', 'å‹¤å¥®å­¸ç¿’'
                ],
                method: [
                    'å¾ªåºæ¼¸é€²', 'æº«æ•…çŸ¥æ–°', 'å­¸æ€ä¸¦é‡', 'èˆ‰ä¸€åä¸‰', 'è§¸é¡æ—é€š'
                ]
            },
            character: {
                moral: [
                    'å“å­¸å…¼å„ª', 'å¾·æ‰å…¼å‚™', 'å“æ ¼é«˜å°š', 'å“è¡Œç«¯æ­£', 'æ“è¡Œè‰¯å¥½',
                    'å“å¾·å„ªè‰¯', 'å“æ€§ç´”è‰¯', 'å¾·è¡Œå…¼å‚™'
                ],
                honest: [
                    'èª å¯¦å¯é ', 'è¨€è¡Œä¸€è‡´', 'è¡¨è£¡å¦‚ä¸€', 'èª æ‡‡å¾…äºº'
                ],
                humble: [
                    'è¬™æ­æœ‰ç¦®', 'è¬™è™›å¥½å­¸', 'è¬™éœæœ‰ç¦®', 'æº«æ–‡å„’é›…', 'å½¬å½¬æœ‰ç¦®'
                ]
            },
            relationship: {
                teamwork: [
                    'åœ˜çµåˆä½œ', 'æ¨‚æ–¼åŠ©äºº', 'èˆ‡äººç‚ºå–„', 'å’Œç¦ç›¸è™•', 'å‹æ„›åŒå­¸',
                    'é—œæ‡·ä»–äºº', 'ç†±å¿ƒåŠ©äºº', 'æœå‹™ç†±å¿±'
                ],
                leadership: [
                    'é ˜å°æœ‰æ–¹', 'çµ„ç¹”èƒ½åŠ›', 'çµ±ç±Œè¦åŠƒ', 'é ˜å°æ‰èƒ½'
                ]
            },
            personality: {
                perseverance: [
                    'å …æŒä¸æ‡ˆ', 'ç™¾æŠ˜ä¸æ’“', 'å …å¿ä¸æ‹”', 'æ„å¿—å …å®š', 'æ†å¿ƒæ¯…åŠ›', 'é¥è€Œä¸æ¨'
                ],
                cheerful: [
                    'æ´»æ½‘é–‹æœ—', 'é–‹æœ—å¤§æ–¹', 'å¤©çœŸæ´»æ½‘', 'ç†±æƒ…é–‹æœ—', 'æ¨‚è§€é€²å–'
                ],
                steady: [
                    'ç©©é‡è¸å¯¦', 'æˆç†Ÿç©©é‡', 'æ²‰ç©©å…§æ–‚', 'è¸å¯¦èªçœŸ'
                ]
            },
            ability: {
                academic: [
                    'æˆç¸¾å„ªç•°', 'å­¸æ¥­é€²æ­¥', 'çªé£›çŒ›é€²', 'ååˆ—å‰èŒ…', 'è„«ç©è€Œå‡º', 'å‡ºé¡æ‹”èƒ'
                ],
                diverse: [
                    'å¤šæ‰å¤šè—', 'æ–‡æ­¦é›™å…¨', 'å…¨é¢ç™¼å±•', 'å¤šæ–¹é¢ç™¼å±•', 'å¾·æ™ºé«”ç¾¤'
                ],
                creative: [
                    'å‰µæ„æ€è€ƒ', 'ç¨ç«‹æ€è€ƒ', 'æ€è·¯æ¸…æ™°', 'é‚è¼¯æ¸…æ¥š'
                ]
            },
            progress: {
                improve: [
                    'æ›´ä¸Šå±¤æ¨“', 'ç²¾ç›Šæ±‚ç²¾', 'ç™¾å°ºç«¿é ­', 'æ—¥æ–°åˆæ–°', 'åŠ›æ±‚ä¸Šé€²'
                ],
                potential: [
                    'æ½›åŠ›ç„¡çª®', 'å‰ç¨‹ä¼¼éŒ¦', 'å¾Œç”Ÿå¯ç•', 'æœªä¾†å¯æœŸ'
                ]
            },
            special: {
                art: [
                    'å¤šæ‰å¤šè—', 'æ–‡è—æ°£æ¯', 'è—è¡“å¤©åˆ†'
                ],
                sports: [
                    'æ–‡æ­¦å…¼å‚™', 'é«”é­„å¼·å¥', 'é‹å‹•ç´°èƒ'
                ],
                service: [
                    'æœå‹™ç†±å¿±', 'å¥‰ç»ç²¾ç¥', 'ç†±å¿ƒæœå‹™', 'å…¬ç›Šæœå‹™'
                ]
            }
        };

        // è©•é‡å‘åº¦è³‡æ–™
        const dimensions = [
            {
                id: 'attitude',
                name: 'ä¸Šèª²æ…‹åº¦',
                comments: {
                    encouraging: [
                        'é‚„æ²’é–‹å§‹å±•ç¾å‡ºå­¸ç¿’çš„ç‹€æ…‹{EXAMPLE}ï¼Œæ²’é—œä¿‚ï¼Œæˆ‘å€‘æœŸå¾…çœ‹åˆ°ä½ ä¸‹ä¸€æ¬¡çš„åƒèˆ‡èˆ‡æ”¹è®Šï¼',
                        'å·²ç¶“é–‹å§‹é€²å…¥æ•™å®¤{EXAMPLE}ï¼Œä¸‹ä¸€æ­¥æ˜¯æ›´å°ˆæ³¨åœ°æŠ•å…¥èª²ç¨‹ï¼Œç›¸ä¿¡ä½ è¾¦å¾—åˆ°ï¼',
                        'æœ‰æ™‚èƒ½å°ˆå¿ƒã€æœ‰æ™‚æœƒåˆ†å¿ƒ{EXAMPLE}ï¼Œä½ çš„åƒèˆ‡æ˜¯å€‹èµ·é»ï¼Œå†åŠ ä¸€é»å°ˆæ³¨å°±æ›´æ£’äº†ï¼',
                        'ä¸Šèª²æ…‹åº¦ç©©å®š{EXAMPLE}ï¼ŒæŒçºŒåŠªåŠ›æœƒè®“ä½ åœ¨èª²å ‚ä¸Šæ›´æœ‰è‡ªä¿¡ã€‚',
                        'ä¸Šèª²è¡¨ç¾ç©©å®š{EXAMPLE}ï¼Œèƒ½ç©æ¥µå›æ‡‰è€å¸«ã€åƒèˆ‡æ´»å‹•ï¼Œæ˜¯å¤§å®¶å­¸ç¿’çš„æ¦œæ¨£ä¹‹ä¸€ã€‚',
                        'ç¸½æ˜¯å…¨ç¥è²«æ³¨ï¼Œç©æ¥µç™¼å•èˆ‡äº’å‹•{EXAMPLE}ï¼Œè®“èª²å ‚å› ä½ è€Œæ›´æœ‰æ´»åŠ›ï¼'
                    ],
                    neutral: [
                        'ç›®å‰åœ¨èª²å ‚åƒèˆ‡æ–¹é¢å°šå¾…æ”¹é€²{EXAMPLE}ï¼Œå»ºè­°å¢åŠ å°ˆæ³¨åº¦ã€‚',
                        'é–‹å§‹åœ¨èª²å ‚ä¸­å±•ç¾å­¸ç¿’æ„é¡˜{EXAMPLE}ï¼Œä»éœ€æŒçºŒæŠ•å…¥ã€‚',
                        'ä¸Šèª²æ…‹åº¦è¡¨ç¾ä¸ç©©å®š{EXAMPLE}ï¼Œæ™‚æœ‰åˆ†å¿ƒæƒ…æ³ã€‚',
                        'ä¸Šèª²æ…‹åº¦åŸºæœ¬ç©©å®š{EXAMPLE}ï¼Œèƒ½ç¶­æŒé©ç•¶çš„å°ˆæ³¨åº¦ã€‚',
                        'ä¸Šèª²è¡¨ç¾è‰¯å¥½{EXAMPLE}ï¼Œèƒ½ä¸»å‹•åƒèˆ‡èª²å ‚æ´»å‹•å’Œå›æ‡‰ã€‚',
                        'ä¸Šèª²æ…‹åº¦å„ªç§€{EXAMPLE}ï¼ŒæŒçºŒå±•ç¾é«˜åº¦å°ˆæ³¨å’Œç©æ¥µåƒèˆ‡ã€‚'
                    ]
                }
            },
            {
                id: 'exam',
                name: 'è€ƒè©¦åˆ†æ•¸',
                comments: {
                    encouraging: [
                        'è€ƒè©¦çš„å‡ºå¸­ç‡ä¸ç†æƒ³{EXAMPLE}ï¼Œå¸Œæœ›ä¸‹æ¬¡èƒ½çœ‹åˆ°ä½ å‹‡æ•¢åœ°å˜—è©¦ï¼Œè®“æˆ‘å€‘ä¸€èµ·è¿æ¥é€²æ­¥çš„é–‹å§‹ï¼',
                        'é›–ç„¶æˆç¸¾é‚„ä¸ç†æƒ³{EXAMPLE}ï¼Œä½†ä½ å·²ç¶“è¸å‡ºç¬¬ä¸€æ­¥ï¼Œæ¯ä¸€é¡Œçš„å˜—è©¦éƒ½å¾ˆæœ‰æ„ç¾©ã€‚',
                        'æŒæ¡äº†ä¸€äº›åŸºç¤å…§å®¹{EXAMPLE}ï¼Œç¹¼çºŒç·´ç¿’ï¼Œç›¸ä¿¡æœƒè¶Šä¾†è¶Šç†Ÿæ‚‰ï¼',
                        'åœ¨ç†è§£åŸºç¤æ¦‚å¿µä¸Šå·²æœ‰ç©©å®šçš„æˆæœ{EXAMPLE}ï¼Œå†å¤šè¤‡ç¿’å°±èƒ½æ›´ä¸Šä¸€å±¤æ¨“ã€‚',
                        'å±•ç¾å‡ºè‰¯å¥½çš„ç†è§£åŠ›{EXAMPLE}ï¼Œå·²ç¶“èƒ½éˆæ´»é‹ç”¨çŸ¥è­˜ï¼ŒæŒçºŒç¶­æŒæœƒæ›´æ£’ï¼',
                        'è€ƒè©¦è¡¨ç¾éå¸¸å„ªç§€{EXAMPLE}ï¼Œä»£è¡¨ä½ ä¸åªç†è§£ï¼Œæ›´èƒ½éˆæ´»é‹ç”¨å­¸åˆ°çš„çŸ¥è­˜ï¼Œå¤ªæ£’äº†ï¼'
                    ],
                    neutral: [
                        'è€ƒè©¦å‡ºå¸­æƒ…æ³éœ€è¦æ”¹å–„{EXAMPLE}ï¼Œå»ºè­°ç©æ¥µåƒèˆ‡æ¸¬é©—ã€‚',
                        'è€ƒè©¦æˆç¸¾ç›®å‰ä»æœ‰é€²æ­¥ç©ºé–“{EXAMPLE}ï¼Œéœ€åŠ å¼·åŸºç¤æ¦‚å¿µç†è§£ã€‚',
                        'å·²æŒæ¡éƒ¨åˆ†åŸºç¤å…§å®¹{EXAMPLE}ï¼Œä½†ä»éœ€æŒçºŒåŠ å¼·ç·´ç¿’ã€‚',
                        'è€ƒè©¦æˆç¸¾é”åˆ°åŸºæœ¬è¦æ±‚{EXAMPLE}ï¼Œåœ¨åŸºç¤æ¦‚å¿µç†è§£ä¸Šè¡¨ç¾ç©©å®šã€‚',
                        'è€ƒè©¦è¡¨ç¾è‰¯å¥½{EXAMPLE}ï¼Œèƒ½æœ‰æ•ˆç†è§£å’Œé‹ç”¨å­¸ç¿’å…§å®¹ã€‚',
                        'è€ƒè©¦æˆç¸¾å„ªç•°{EXAMPLE}ï¼Œå±•ç¾å‡ºæ‰å¯¦çš„çŸ¥è­˜åŸºç¤å’Œæ‡‰ç”¨èƒ½åŠ›ã€‚'
                    ]
                }
            },
            {
                id: 'notes',
                name: 'ç­†è¨˜åˆ†æ•¸',
                comments: {
                    encouraging: [
                        'é€™æ¬¡é‚„æ²’æœ‰ç­†è¨˜çš„ç´€éŒ„{EXAMPLE}ï¼Œä½†ä¸‹æ¬¡é–‹å§‹å‹•ç­†å°±æœƒæ˜¯å¾ˆæ£’çš„é–‹å§‹ï¼',
                        'æœ‰è¨˜ä¸‹ä¸€äº›å…§å®¹{EXAMPLE}ï¼Œä¸‹ä¸€æ¬¡å¯ä»¥è©¦è‘—æŠ“å‡ºæ›´å¤šé‡é»å–”ï¼',
                        'å·²é–‹å§‹è¨˜éŒ„é‡è¦æ¦‚å¿µäº†{EXAMPLE}ï¼Œè‹¥èƒ½æ›´æœ‰æ¢ç†ï¼Œæ•ˆæœæœƒæ›´å¥½ã€‚',
                        'ç­†è¨˜å·²æœ‰ä¸€å®šç³»çµ±{EXAMPLE}ï¼Œå»ºè­°å˜—è©¦åŠ äº›æ•´ç†å’Œè‡ªå·±çš„æƒ³æ³•ï¼Œæœƒæ›´æœ‰å¹«åŠ©ã€‚',
                        'ç­†è¨˜æ¸…æ¥šã€æœ‰æ¢ç†{EXAMPLE}ï¼Œå­¸ç¿’çš„ç—•è·¡éå¸¸æ˜é¡¯ï¼Œåšå¾—å¾ˆå¥½ï¼',
                        'ç­†è¨˜ä¸ä½†å®Œæ•´{EXAMPLE}ï¼Œè€Œä¸”æœ‰æ•´ç†èˆ‡å»¶ä¼¸æ€è€ƒï¼Œæ˜¯æ¥µå…·åƒè€ƒåƒ¹å€¼çš„ä½œå“ï¼'
                    ],
                    neutral: [
                        'ç›®å‰ç¼ºä¹ç­†è¨˜è¨˜éŒ„{EXAMPLE}ï¼Œå»ºè­°é–‹å§‹é¤Šæˆè¨˜éŒ„ç¿’æ…£ã€‚',
                        'ç­†è¨˜å…§å®¹è¼ƒç‚ºç°¡ç•¥{EXAMPLE}ï¼Œéœ€è¦å¢åŠ é‡é»è¨˜éŒ„çš„å®Œæ•´æ€§ã€‚',
                        'å·²é–‹å§‹è¨˜éŒ„é‡è¦æ¦‚å¿µ{EXAMPLE}ï¼Œä½†çµ„ç¹”çµæ§‹ä»éœ€æ”¹å–„ã€‚',
                        'ç­†è¨˜å…·æœ‰åŸºæœ¬çš„ç³»çµ±æ€§{EXAMPLE}ï¼Œå…§å®¹è¨˜éŒ„é©åº¦ã€‚',
                        'ç­†è¨˜è¨˜éŒ„æ¸…æ¥šæœ‰æ¢ç†{EXAMPLE}ï¼Œèƒ½æœ‰æ•ˆæŒæ¡å­¸ç¿’é‡é»ã€‚',
                        'ç­†è¨˜å…§å®¹å®Œæ•´ä¸”å…·æœ‰å€‹äººæ•´ç†å’Œæ€è€ƒ{EXAMPLE}ï¼Œå“è³ªå„ªè‰¯ã€‚'
                    ]
                }
            },
            {
                id: 'peer',
                name: 'åŒå„•é—œä¿‚',
                comments: {
                    encouraging: [
                        'èˆ‡åŒå­¸äº’å‹•çš„æ©Ÿæœƒé‚„ä¸å¤š{EXAMPLE}ï¼Œè©¦è‘—ä¸»å‹•åƒèˆ‡ï¼Œç›¸ä¿¡æœƒæœ‰ä¸ä¸€æ¨£çš„æ”¶ç©«ï¼',
                        'æ­£åœ¨å­¸ç¿’å¦‚ä½•èˆ‡åŒå„•ç›¸è™•{EXAMPLE}ï¼Œå¶çˆ¾æœƒé‡åˆ°æŒ‘æˆ°ï¼Œä½†é€™æ­£æ˜¯æˆé•·çš„å¥‘æ©Ÿã€‚',
                        'èˆ‡éƒ¨åˆ†åŒå­¸ç›¸è™•èæ´½{EXAMPLE}ï¼Œå†å¤šä¸€é»ä¸»å‹•äº’å‹•ï¼Œæœƒè®“ä½ æ›´èå…¥ç­ç´šå–”ã€‚',
                        'èƒ½èˆ‡å¤§å®¶å’Œå¹³ç›¸è™•{EXAMPLE}ï¼Œè¡¨ç¾å‡ºåŸºæœ¬çš„åˆä½œèˆ‡å°Šé‡ï¼Œæ˜¯å€¼å¾—è‚¯å®šçš„ï¼',
                        'æ¨‚æ–¼èˆ‡äººåˆä½œ{EXAMPLE}ï¼Œä¹Ÿèƒ½å‚¾è½èˆ‡æºé€šï¼Œæ˜¯åœ˜é«”ä¸­çš„å¥½å¤¥ä¼´ï¼',
                        'æ˜¯ä¿ƒé€²ç­ç´šæ°£æ°›çš„é—œéµäººç‰©{EXAMPLE}ï¼Œç¸½æ˜¯å¸¶ä¾†æ­£é¢å½±éŸ¿ï¼Œè®“åŒå„•æ„Ÿåˆ°æº«æš–ï¼'
                    ],
                    neutral: [
                        'èˆ‡åŒå­¸äº’å‹•é »ç‡è¼ƒä½{EXAMPLE}ï¼Œå»ºè­°å¢åŠ ä¸»å‹•åƒèˆ‡ç­ç´šæ´»å‹•ã€‚',
                        'åœ¨åŒå„•ç›¸è™•æ–¹é¢ä»åœ¨å­¸ç¿’é©æ‡‰{EXAMPLE}ï¼Œå¶æœ‰äº’å‹•ä¸Šçš„å›°é›£ã€‚',
                        'èˆ‡éƒ¨åˆ†åŒå­¸ç›¸è™•è‰¯å¥½{EXAMPLE}ï¼Œä½†æ•´é«”ç¤¾äº¤åƒèˆ‡åº¦å¯å†æå‡ã€‚',
                        'èƒ½èˆ‡åŒå­¸å’Œå¹³ç›¸è™•{EXAMPLE}ï¼Œå±•ç¾åŸºæœ¬çš„åˆä½œæ…‹åº¦å’Œäººéš›å°Šé‡ã€‚',
                        'åŒå„•é—œä¿‚è‰¯å¥½{EXAMPLE}ï¼Œå…·å‚™åˆä½œæºé€šèƒ½åŠ›ï¼Œæ˜¯ç­ç´šä¸­çš„å”èª¿è€…ã€‚',
                        'åœ¨ç­ç´šä¸­ç™¼æ®æ­£å‘å½±éŸ¿åŠ›{EXAMPLE}ï¼ŒåŒå„•é—œä¿‚å’Œè«§ï¼Œç¤¾äº¤èƒ½åŠ›å„ªç§€ã€‚'
                    ]
                }
            },
            {
                id: 'selflearn',
                name: 'è‡ªä¸»å­¸ç¿’',
                comments: {
                    encouraging: [
                        'é‚„æ²’å±•é–‹è‡ªä¸»å­¸ç¿’çš„æ—…ç¨‹{EXAMPLE}ï¼Œæ²’é—œä¿‚ï¼Œä¸‹ä¸€æ­¥æ˜¯æœ€é‡è¦çš„é–‹å§‹ã€‚',
                        'å·²ç¶“é–‹å§‹æ³¨æ„èª²æ¥­äº†{EXAMPLE}ï¼Œè‹¥èƒ½è‡ªå·±å®‰æ’ä¸€äº›ç·´ç¿’ï¼Œå°±æ›´é€²æ­¥å›‰ï¼',
                        'é¡˜æ„åœ¨éœ€è¦æ™‚å­¸ç¿’{EXAMPLE}ï¼Œå†å¤šä¸€äº›ä¸»å‹•æ¢ç´¢å°±èƒ½çœ‹è¦‹æ›´å¤§çš„é€²æ­¥ã€‚',
                        'èƒ½å®Œæˆè€å¸«å®‰æ’çš„ä»»å‹™{EXAMPLE}ï¼Œè‹¥èƒ½ä¸»å‹•å»¶ä¼¸å­¸ç¿’æœƒæ›´ç†æƒ³ã€‚',
                        'å…·å‚™è‰¯å¥½çš„å­¸ç¿’è¦åŠƒ{EXAMPLE}ï¼Œèƒ½æŒæ¡é€²åº¦ï¼Œä¹Ÿæœƒæ‰¾è³‡æºå¹«åŠ©è‡ªå·±å­¸ç¿’ã€‚',
                        'å±•ç¾å‡ºå¼·çƒˆçš„å­¸ç¿’å‹•åŠ›èˆ‡è²¬ä»»æ„Ÿ{EXAMPLE}ï¼Œæ˜¯è‡ªä¸»å­¸ç¿’çš„å…¸ç¯„ï¼'
                    ],
                    neutral: [
                        'è‡ªä¸»å­¸ç¿’èƒ½åŠ›å°šå¾…é–‹ç™¼{EXAMPLE}ï¼Œå»ºè­°åŸ¹é¤Šä¸»å‹•å­¸ç¿’çš„ç¿’æ…£ã€‚',
                        'é–‹å§‹é—œæ³¨å€‹äººå­¸ç¿’é€²åº¦{EXAMPLE}ï¼Œä½†è‡ªä¸»å®‰æ’ç·´ç¿’çš„èƒ½åŠ›éœ€è¦åŠ å¼·ã€‚',
                        'å…·æœ‰åŸºæœ¬çš„å­¸ç¿’è‡ªè¦ºæ€§{EXAMPLE}ï¼Œä½†ä¸»å‹•æ¢ç´¢å­¸ç¿’çš„ç©æ¥µåº¦å¯å†æå‡ã€‚',
                        'èƒ½æŒ‰æ™‚å®ŒæˆæŒ‡å®šä½œæ¥­{EXAMPLE}ï¼Œè‡ªä¸»å»¶ä¼¸å­¸ç¿’çš„è¡¨ç¾æœ‰å¾…åŠ å¼·ã€‚',
                        'å±•ç¾è‰¯å¥½çš„å­¸ç¿’è¦åŠƒèƒ½åŠ›{EXAMPLE}ï¼Œèƒ½ä¸»å‹•å°‹æ‰¾å­¸ç¿’è³‡æºä¸¦æŒæ¡é€²åº¦ã€‚',
                        'è‡ªä¸»å­¸ç¿’èƒ½åŠ›å„ªç§€{EXAMPLE}ï¼Œå…·å‚™å¼·çƒˆçš„å­¸ç¿’å‹•æ©Ÿå’Œè‰¯å¥½çš„è‡ªæˆ‘ç®¡ç†èƒ½åŠ›ã€‚'
                    ]
                }
            },
            {
                id: 'attendance',
                name: 'ç”Ÿæ´»å¸¸è¦ï¼ˆå‡ºç¼ºå¸­ï¼‰',
                comments: {
                    encouraging: [
                        'ç¼ºå¸­ç‹€æ³è¼ƒåš´é‡{EXAMPLE}ï¼ŒæœŸå¾…çœ‹åˆ°ä½ çš„èº«å½±ï¼Œä¸€èµ·åŠ å…¥æˆ‘å€‘çš„å­¸ç¿’æ—…ç¨‹ï¼',
                        'å·²ç¶“é–‹å§‹ç©©å®šå‡ºå¸­å¹¾æ¬¡èª²ç¨‹{EXAMPLE}ï¼Œé€™æ˜¯ä¸€å€‹å¾ˆå¥½çš„èµ·é»ï¼Œç¹¼çºŒä¿æŒå–”ï¼',
                        'å‡ºå¸­æƒ…æ³é€æ¼¸ç©©å®šäº†{EXAMPLE}ï¼Œå†å¤šä¸€é»è¦å¾‹å°±æ›´æ£’äº†ï¼Œç›¸ä¿¡ä½ åšå¾—åˆ°ï¼',
                        'å¤§å¤šæ•¸æ™‚é–“éƒ½èƒ½æº–æ™‚åˆ°èª²{EXAMPLE}ï¼Œè¡¨ç¾å‡ºåŸºæœ¬çš„è²¬ä»»æ„Ÿï¼Œæ˜¯å€¼å¾—è‚¯å®šçš„é€²æ­¥ã€‚',
                        'å¹¾ä¹æ¯æ¬¡éƒ½æº–æ™‚å‡ºå¸­èª²å ‚{EXAMPLE}ï¼Œå±•ç¾å‡ºç©©å®šçš„å­¸ç¿’æ…‹åº¦èˆ‡è‡ªå¾‹èƒ½åŠ›ã€‚',
                        'ç¸½æ˜¯æº–æ™‚å‡ºå¸­ä¸”æœ‰æº–å‚™{EXAMPLE}ï¼Œæ˜¯æ™‚é–“ç®¡ç†èˆ‡è²¬ä»»æ„Ÿçš„æœ€ä½³å…¸ç¯„ï¼'
                    ],
                    neutral: [
                        'å‡ºç¼ºå¸­ç‹€æ³éœ€è¦æ”¹å–„{EXAMPLE}ï¼Œå»ºè­°å»ºç«‹è¦å¾‹çš„å‡ºå¸­ç¿’æ…£ã€‚',
                        'é–‹å§‹ç©©å®šå‡ºå¸­éƒ¨åˆ†èª²ç¨‹{EXAMPLE}ï¼Œä»éœ€æŒçºŒæ”¹å–„å‡ºå¸­ç‡ã€‚',
                        'å‡ºå¸­æƒ…æ³æœ‰æ‰€æ”¹å–„{EXAMPLE}ï¼Œä½†ä»éœ€è¦æ›´ç©©å®šçš„è¡¨ç¾ã€‚',
                        'å¤§å¤šæ•¸æ™‚é–“èƒ½æº–æ™‚å‡ºå¸­{EXAMPLE}ï¼Œå±•ç¾åŸºæœ¬çš„è²¬ä»»æ„Ÿã€‚',
                        'å‡ºå¸­ç‹€æ³è‰¯å¥½{EXAMPLE}ï¼Œèƒ½ç¶­æŒç©©å®šçš„å­¸ç¿’æ…‹åº¦ã€‚',
                        'å‡ºå¸­è¡¨ç¾å„ªç§€{EXAMPLE}ï¼Œå±•ç¾å‡ºè‰¯å¥½çš„æ™‚é–“ç®¡ç†èˆ‡è²¬ä»»æ„Ÿã€‚'
                    ]
                }
            }
        ];

        // å„²å­˜åˆ†æ•¸ç‹€æ…‹
        let scores = {};
        
        // å„²å­˜å…·é«”äº‹ä¾‹
        let examples = {};
        
        // å„²å­˜é›·é”åœ–å¯¦ä¾‹
        let radarChart = null;

        // åˆå§‹åŒ–è©•é‡é …ç›®
        function initializeEvaluationItems() {
            const container = document.getElementById('evaluationItems');
            
            dimensions.forEach(dim => {
                const itemHTML = `
                    <div class="evaluation-item">
                        <div class="evaluation-header">
                            <span class="evaluation-title">${dim.name}</span>
                            <span class="score-display" id="score-${dim.id}">-</span>
                        </div>
                        <div class="score-buttons">
                            <button class="score-btn no-score" onclick="setScore('${dim.id}', null)">æœªè©•åˆ†</button>
                            ${[0, 1, 2, 3, 4, 5].map(score => 
                                `<button class="score-btn" onclick="setScore('${dim.id}', ${score})">${score}</button>`
                            ).join('')}
                        </div>
                        <div class="example-input-section">
                            <label class="example-label" for="example-${dim.id}">å…·é«”äº‹ä¾‹ (é¸å¡«)</label>
                            <input type="text" id="example-${dim.id}" class="example-input" 
                                   placeholder="ä¾‹å¦‚ï¼šä¸Šé€±ä¸»å‹•å¹«åŠ©åŒå­¸è§£é¡Œã€æ®µè€ƒæœŸé–“èªçœŸè¤‡ç¿’ã€é€£çºŒä¸‰é€±æº–æ™‚åˆ°èª²..." 
                                   onchange="setExample('${dim.id}', this.value)">
                            <small class="example-hint">è¼¸å…¥å…·é«”äº‹ä¾‹å¯è®“è©•èªæ›´åŠ å€‹äººåŒ–</small>
                        </div>
                    </div>
                `;
                container.innerHTML += itemHTML;
            });
        }

        // è¨­å®šåˆ†æ•¸
        function setScore(dimensionId, score) {
            if (score === null) {
                delete scores[dimensionId];
                document.getElementById(`score-${dimensionId}`).textContent = '-';
            } else {
                scores[dimensionId] = score;
                document.getElementById(`score-${dimensionId}`).textContent = score;
            }
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const buttons = document.querySelectorAll(`.evaluation-item:has(#score-${dimensionId}) .score-btn`);
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (score === null && btn.classList.contains('no-score')) {
                    btn.classList.add('active');
                } else if (btn.textContent === String(score)) {
                    btn.classList.add('active');
                }
            });
            
            // å¦‚æœæ˜¯æ‰¹é‡è©•åˆ†æ¨¡å¼ï¼Œå³æ™‚ä¿å­˜åˆ°ç•¶å‰å­¸ç”Ÿ
            if (currentStudentIndex >= 0 && studentList.length > 0) {
                const studentName = studentList[currentStudentIndex];
                if (!studentScores[studentName]) {
                    studentScores[studentName] = {};
                }
                if (score !== null) {
                    studentScores[studentName][dimensionId] = score;
                } else {
                    delete studentScores[studentName][dimensionId];
                }
                
                // æ›´æ–°å­¸ç”Ÿåˆ—è¡¨é¡¯ç¤º
                displayStudentList();
            }
        }

        // è¨­å®šå…·é«”äº‹ä¾‹
        function setExample(dimensionId, example) {
            if (example && example.trim()) {
                examples[dimensionId] = example.trim();
            } else {
                delete examples[dimensionId];
            }
            
            // å¦‚æœæ˜¯æ‰¹é‡è©•åˆ†æ¨¡å¼ï¼Œå³æ™‚ä¿å­˜åˆ°ç•¶å‰å­¸ç”Ÿ
            if (currentStudentIndex >= 0 && studentList.length > 0) {
                const studentName = studentList[currentStudentIndex];
                if (!studentExamples[studentName]) {
                    studentExamples[studentName] = {};
                }
                if (example && example.trim()) {
                    studentExamples[studentName][dimensionId] = example.trim();
                } else {
                    delete studentExamples[studentName][dimensionId];
                }
            }
        }

        // ç”Ÿæˆè©•èª
        function generateComment() {
            const studentName = document.getElementById('studentName').value.trim();
            
            if (Object.keys(scores).length === 0) {
                alert('è«‹è‡³å°‘è©•åˆ†ä¸€å€‹å‘åº¦');
                return;
            }
            
            // å–å¾—é¸æ“‡çš„èªæ°£å’Œé¢¨æ ¼
            const selectedTone = document.querySelector('input[name="commentTone"]:checked').value;
            const selectedStyle = document.querySelector('input[name="commentStyle"]:checked').value;
            
            // å°‡æœ‰åˆ†æ•¸çš„å‘åº¦æŒ‰åˆ†æ•¸é«˜ä½æ’åº
            const sortedDimensions = Object.entries(scores)
                .map(([dimId, score]) => {
                    const dim = dimensions.find(d => d.id === dimId);
                    let comment = dim.comments[selectedTone][score];
                    
                    // è™•ç†å…·é«”äº‹ä¾‹çš„æ’å…¥
                    if (examples[dimId]) {
                        comment = comment.replace('{EXAMPLE}', `ï¼Œå¦‚${examples[dimId]}`);
                    } else {
                        comment = comment.replace('{EXAMPLE}', '');
                    }
                    
                    return {
                        id: dimId,
                        name: dim.name,
                        score: score,
                        comment: comment
                    };
                })
                .sort((a, b) => b.score - a.score);
            
            // æ ¹æ“šé¸æ“‡çš„é¢¨æ ¼ç”Ÿæˆè©•èª
            let comment = '';
            
            switch(selectedStyle) {
                case 'style1':
                    comment = generateStyle1(studentName, sortedDimensions, selectedTone);
                    break;
                case 'style2':
                    comment = generateStyle2(studentName, sortedDimensions, selectedTone);
                    break;
                case 'style3':
                    comment = generateStyle3(studentName, sortedDimensions, selectedTone);
                    break;
            }
            
            // è¨­å®šç•¶å‰ç”Ÿæˆçš„è©•èª
            currentGeneratedComment = comment;
            currentCommentType = 'scoring';
            
            // é¡¯ç¤ºçµæœ
            document.getElementById('commentText').textContent = comment;
            
            // é¡¯ç¤ºæœªå„²å­˜ç‹€æ…‹
            updateCommentStatus('unsaved');
            
            // éš±è—é‡æ–°ç”ŸæˆæŒ‰éˆ•ï¼Œé¡¯ç¤ºé›·é”åœ–
            document.getElementById('regenerateIdiomBtn').style.display = 'none';
            document.querySelector('.radar-chart-section').style.display = 'block';
            
            // ç”Ÿæˆé›·é”åœ–
            generateRadarChart();
            
            document.getElementById('resultSection').classList.add('show');
            
            // æ»¾å‹•åˆ°çµæœå€åŸŸ
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }

        // é¢¨æ ¼ä¸€ï¼šå¤šæ¨£åŒ–éŠœæ¥è©
        function generateStyle1(studentName, sortedDimensions, selectedTone) {
            let comment = studentName ? `${studentName}åŒå­¸ï¼Œ` : '';
            
            const connectors = {
                attitude: ['åœ¨ä¸Šèª²æ…‹åº¦æ–¹é¢ï¼Œ', 'ä¸Šèª²æ…‹åº¦ä¸Šï¼Œ', 'èª²å ‚è¡¨ç¾æ–¹é¢ï¼Œ'],
                exam: ['è€ƒè©¦çš„è¡¨ç¾é¡¯ç¤º', 'å­¸ç¿’æˆæœé¡¯ç¤º', 'æ¸¬é©—è¡¨ç¾ä¸Šï¼Œ'],
                notes: ['é—œæ–¼ç­†è¨˜ç¿’æ…£ï¼Œ', 'åœ¨ç­†è¨˜è¨˜éŒ„ä¸Šï¼Œ', 'å­¸ç¿’ç­†è¨˜æ–¹é¢ï¼Œ'],
                peer: ['èˆ‡åŒå­¸ç›¸è™•ä¸Šï¼Œ', 'åœ¨åŒå„•äº’å‹•æ–¹é¢ï¼Œ', 'äººéš›é—œä¿‚è¡¨ç¾ä¸Šï¼Œ'],
                selflearn: ['è‡³æ–¼è‡ªä¸»å­¸ç¿’ï¼Œ', 'åœ¨è‡ªæˆ‘å­¸ç¿’éƒ¨åˆ†ï¼Œ', 'å­¸ç¿’è‡ªä¸»æ€§æ–¹é¢ï¼Œ'],
                attendance: ['åœ¨ç”Ÿæ´»å¸¸è¦æ–¹é¢ï¼Œ', 'å‡ºç¼ºå¸­è¡¨ç¾ä¸Šï¼Œ', 'ç”Ÿæ´»ç®¡ç†ä¸Šï¼Œ']
            };
            
            sortedDimensions.forEach((dim, index) => {
                const connector = connectors[dim.id][0];
                
                if (index === 0) {
                    comment += `${connector}${dim.comment}`;
                } else if (index === sortedDimensions.length - 1) {
                    comment += `å¦å¤–ï¼Œ${connector}${dim.comment}`;
                } else {
                    comment += connector + dim.comment;
                }
            });
            
            // æ ¹æ“šèªæ°£é¸æ“‡ä¸åŒçš„çµå°¾
            const endings = {
                encouraging: 'æœŸå¾…çœ‹åˆ°ä½ æŒçºŒçš„æˆé•·èˆ‡é€²æ­¥ï¼',
                neutral: 'å»ºè­°æŒçºŒåŠªåŠ›ï¼ŒæœŸæœ›æœªä¾†èƒ½æœ‰æ›´å¥½çš„è¡¨ç¾ã€‚'
            };
            
            comment += endings[selectedTone];
            return comment;
        }

        // é¢¨æ ¼äºŒï¼šè‡ªç„¶èªå¥èåˆ
        function generateStyle2(studentName, sortedDimensions, selectedTone) {
            let comment = studentName ? `${studentName}åŒå­¸ï¼Œ` : '';
            
            const naturalPhrases = {
                attitude: {
                    high: 'èª²å ‚ä¸Šçš„ä½ ',
                    mid: 'åœ¨å­¸ç¿’éç¨‹ä¸­',
                    low: 'æœªä¾†åœ¨èª²å ‚ä¸Š'
                },
                exam: {
                    high: 'å­¸ç¿’æˆæœä»¤äººæ¬£æ…°ï¼Œ',
                    mid: 'å­¸ç¿’æˆæœé¡¯ç¤º',
                    low: 'åœ¨çŸ¥è­˜æŒæ¡ä¸Š'
                },
                notes: {
                    high: 'å­¸ç¿’è¨˜éŒ„ç›¸ç•¶ç”¨å¿ƒï¼Œ',
                    mid: 'åœ¨è¨˜éŒ„å­¸ç¿’é‡é»æ™‚',
                    low: 'æœªä¾†è¨˜éŒ„å­¸ç¿’å…§å®¹æ™‚'
                },
                peer: {
                    high: 'ä½ ',
                    mid: 'èˆ‡åŒå­¸ç›¸è™•æ™‚',
                    low: 'åœ¨ç­ç´šäº’å‹•ä¸­'
                },
                selflearn: {
                    high: 'å­¸ç¿’æ…‹åº¦ç©æ¥µä¸»å‹•ï¼Œ',
                    mid: 'æ­¤å¤–ï¼Œ',
                    low: 'åœ¨èª²å¾Œå­¸ç¿’ä¸Š'
                },
                attendance: {
                    high: 'å‡ºå¸­è¡¨ç¾å„ªç•°ï¼Œ',
                    mid: 'åœ¨æ™‚é–“ç®¡ç†ä¸Š',
                    low: 'åœ¨å‡ºå¸­è¦å¾‹ä¸Š'
                }
            };
            
            sortedDimensions.forEach((dim, index) => {
                const level = dim.score >= 4 ? 'high' : (dim.score >= 2 ? 'mid' : 'low');
                const phrase = naturalPhrases[dim.id][level];
                
                if (index === 0) {
                    comment += `${phrase}${dim.comment}`;
                } else if (index === 1) {
                    comment += `åŒæ™‚ï¼Œ${phrase}${dim.comment}`;
                } else if (index === sortedDimensions.length - 1) {
                    comment += `${phrase}${dim.comment}`;
                } else {
                    comment += `${phrase}${dim.comment}`;
                }
            });
            
            // æ ¹æ“šèªæ°£é¸æ“‡ä¸åŒçš„çµå°¾
            const endings = {
                encouraging: 'ç›¸ä¿¡ä½ æœƒè¶Šä¾†è¶Šé€²æ­¥ï¼',
                neutral: 'å¸Œæœ›èƒ½æŒçºŒä¿æŒå­¸ç¿’çš„ç©©å®šåº¦ã€‚'
            };
            
            comment += endings[selectedTone];
            return comment;
        }

        // é¢¨æ ¼ä¸‰ï¼šé‚è¼¯åˆ†çµ„é€£æ¥
        function generateStyle3(studentName, sortedDimensions, selectedTone) {
            let comment = studentName ? `${studentName}åŒå­¸ï¼Œ` : '';
            
            // å°‡å‘åº¦åˆ†çµ„
            const groups = {
                classroom: [], // èª²å ‚ç›¸é—œï¼šæ…‹åº¦ã€ç­†è¨˜
                performance: [], // è¡¨ç¾ç›¸é—œï¼šè€ƒè©¦ã€è‡ªä¸»å­¸ç¿’
                social: [], // ç¤¾äº¤ç›¸é—œï¼šåŒå„•é—œä¿‚
                management: [] // ç®¡ç†ç›¸é—œï¼šå‡ºç¼ºå¸­
            };
            
            sortedDimensions.forEach(dim => {
                if (dim.id === 'attitude' || dim.id === 'notes') {
                    groups.classroom.push(dim);
                } else if (dim.id === 'exam' || dim.id === 'selflearn') {
                    groups.performance.push(dim);
                } else if (dim.id === 'peer') {
                    groups.social.push(dim);
                } else if (dim.id === 'attendance') {
                    groups.management.push(dim);
                }
            });
            
            let hasContent = false;
            
            // ç”Ÿæ´»ç®¡ç†è¡¨ç¾
            if (groups.management.length > 0) {
                groups.management.forEach(dim => {
                    comment += `åœ¨ç”Ÿæ´»ç®¡ç†ä¸Š${dim.comment}`;
                });
                hasContent = true;
            }
            
            // ç¤¾äº¤è¡¨ç¾
            if (groups.social.length > 0) {
                if (hasContent) comment += 'åœ¨ç­ç´šä¸­ï¼Œ';
                groups.social.forEach(dim => {
                    comment += `${dim.comment}`;
                });
                hasContent = true;
            }
            
            // èª²å ‚è¡¨ç¾
            if (groups.classroom.length > 0) {
                if (hasContent) comment += 'å­¸ç¿’æ–¹é¢ï¼Œ';
                groups.classroom.forEach((dim, index) => {
                    if (index === 0) {
                        comment += dim.comment;
                    } else {
                        comment += `åŒæ™‚${dim.comment}`;
                    }
                });
                hasContent = true;
            }
            
            // å­¸ç¿’æˆæœ
            if (groups.performance.length > 0) {
                if (hasContent) comment += 'åœ¨å­¸ç¿’æˆæœä¸Šï¼Œ';
                groups.performance.forEach((dim, index) => {
                    if (index === 0) {
                        comment += dim.comment;
                    } else {
                        comment += `è€Œä¸”${dim.comment}`;
                    }
                });
            }
            
            // æ ¹æ“šèªæ°£é¸æ“‡ä¸åŒçš„çµå°¾
            const endings = {
                encouraging: 'ç¹¼çºŒä¿æŒé€™æ¨£çš„å­¸ç¿’æ…‹åº¦ï¼Œä¸€å®šæœƒæœ‰æ›´å¤§çš„æ”¶ç©«ï¼',
                neutral: 'å»ºè­°ç¹¼çºŒç¶­æŒç›®å‰çš„å­¸ç¿’æ–¹å‘ï¼Œä¸¦å°‹æ±‚é€²ä¸€æ­¥æ”¹å–„ã€‚'
            };
            
            comment += endings[selectedTone];
            return comment;
        }

        // ç”Ÿæˆé›·é”åœ–
        function generateRadarChart() {
            // æº–å‚™é›·é”åœ–æ•¸æ“š
            const dimensionNames = ['ä¸Šèª²æ…‹åº¦', 'è€ƒè©¦åˆ†æ•¸', 'ç­†è¨˜åˆ†æ•¸', 'åŒå„•é—œä¿‚', 'è‡ªä¸»å­¸ç¿’', 'ç”Ÿæ´»å¸¸è¦'];
            const dimensionIds = ['attitude', 'exam', 'notes', 'peer', 'selflearn', 'attendance'];
            
            const data = dimensionIds.map(id => scores[id] || 0);
            
            // éŠ·æ¯€ç¾æœ‰åœ–è¡¨
            if (radarChart) {
                radarChart.destroy();
            }
            
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: dimensionNames,
                    datasets: [{
                        label: 'å­¸ç”Ÿèƒ½åŠ›è©•åˆ†',
                        data: data,
                        backgroundColor: 'rgba(147, 112, 219, 0.2)',
                        borderColor: 'rgba(147, 112, 219, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(147, 112, 219, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5,
                            min: 0,
                            ticks: {
                                stepSize: 1,
                                display: true,
                                font: {
                                    size: 12
                                }
                            },
                            grid: {
                                color: 'rgba(147, 112, 219, 0.3)'
                            },
                            angleLines: {
                                color: 'rgba(147, 112, 219, 0.3)'
                            },
                            pointLabels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#333'
                            }
                        }
                    }
                }
            });
        }

        // è¤‡è£½è©•èª
        function copyComment() {
            const commentText = document.getElementById('commentText').textContent;
            
            navigator.clipboard.writeText(commentText).then(() => {
                const copyBtn = document.querySelector('.copy-btn');
                copyBtn.textContent = 'å·²è¤‡è£½ï¼';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.textContent = 'è¤‡è£½è©•èª';
                    copyBtn.classList.remove('copied');
                }, 2000);
            }).catch(() => {
                // èˆŠç‰ˆç€è¦½å™¨ç›¸å®¹æ€§è™•ç†
                const textArea = document.createElement('textarea');
                textArea.value = commentText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const copyBtn = document.querySelector('.copy-btn');
                copyBtn.textContent = 'å·²è¤‡è£½ï¼';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.textContent = 'è¤‡è£½è©•èª';
                    copyBtn.classList.remove('copied');
                }, 2000);
            });
        }

        // é‡ç½®è¡¨å–®
        function resetForm() {
            // åœ¨æ‰¹é‡è©•åˆ†æ¨¡å¼ä¸‹ï¼Œè©¢å•æ˜¯å¦è¦é‡ç½®æ‰€æœ‰è³‡æ–™
            if (studentList.length > 0) {
                const confirmReset = confirm('é€™å°‡æ¸…é™¤æ‰€æœ‰å­¸ç”Ÿçš„è©•åˆ†è³‡æ–™ï¼Œç¢ºå®šè¦é‡ç½®å—ï¼Ÿ');
                if (!confirmReset) return;
                
                // é‡ç½®æ‰¹é‡è©•åˆ†è³‡æ–™
                studentList = [];
                studentScores = {};
                studentExamples = {};
                studentComments = {};
                currentStudentIndex = -1;
                currentGeneratedComment = '';
                currentCommentType = '';
                
                // éš±è—ç›¸é—œå€åŸŸ
                document.getElementById('studentListSection').classList.remove('show');
                document.getElementById('batchOverviewSection').classList.remove('show');
                document.getElementById('currentStudentIndicator').style.display = 'none';
                
                // æ¸…ç©ºæª”æ¡ˆä¸Šå‚³é¡¯ç¤º
                document.getElementById('fileInfo').classList.remove('show');
                document.getElementById('fileInput').value = '';
                
                // æ¸…ç©ºä¸‹æ‹‰é¸å–®å’Œæœå°‹æ¡†
                document.getElementById('studentSelector').innerHTML = '<option value="">-- è«‹é¸æ“‡å­¸ç”Ÿ --</option>';
                document.getElementById('studentSearch').value = '';
            }
            
            // æ¸…ç©ºå­¸ç”Ÿå§“å
            document.getElementById('studentName').value = '';
            
            // é‡ç½®æ‰€æœ‰åˆ†æ•¸
            scores = {};
            dimensions.forEach(dim => {
                setScore(dim.id, null);
            });
            
            // æ¸…ç©ºæ‰€æœ‰å…·é«”äº‹ä¾‹
            examples = {};
            dimensions.forEach(dim => {
                document.getElementById(`example-${dim.id}`).value = '';
            });
            
            // æ¸…ç©ºè©•èªç›¸é—œè³‡æ–™
            currentGeneratedComment = '';
            currentCommentType = '';
            if (studentList.length === 0) {
                studentComments = {};
            }
            
            // æ¸…é™¤é›·é”åœ–
            if (radarChart) {
                radarChart.destroy();
                radarChart = null;
            }
            
            // éš±è—çµæœå€åŸŸ
            document.getElementById('resultSection').classList.remove('show');
            
            // æ»¾å‹•åˆ°é ‚éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // è¨­å®šæ‹–æ‹½ä¸Šå‚³åŠŸèƒ½
        function setupDragAndDrop() {
            const uploadSection = document.getElementById('fileUploadSection');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadSection.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadSection.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadSection.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight(e) {
                uploadSection.classList.add('dragover');
            }
            
            function unhighlight(e) {
                uploadSection.classList.remove('dragover');
            }
            
            uploadSection.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    const file = files[0];
                    document.getElementById('fileInput').files = files;
                    handleFileUpload({ target: { files: [file] } });
                }
            }
        }

        // å„²å­˜é¸æ“‡çš„æˆèª
        let selectedIdioms = [];

        // æ‰¹é‡è©•åˆ†ç›¸é—œè®Šæ•¸
        let studentList = [];
        let currentStudentIndex = -1;
        let studentScores = {}; // å„²å­˜æ‰€æœ‰å­¸ç”Ÿçš„è©•åˆ†æ•¸æ“š
        let studentExamples = {}; // å„²å­˜æ‰€æœ‰å­¸ç”Ÿçš„å…·é«”äº‹ä¾‹
        let studentComments = {}; // å„²å­˜æ‰€æœ‰å­¸ç”Ÿçš„è©•èª
        let currentGeneratedComment = ''; // ç•¶å‰ç”Ÿæˆä½†æœªå„²å­˜çš„è©•èª
        let currentCommentType = ''; // ç•¶å‰è©•èªé¡å‹ï¼ˆscoring/idiomsï¼‰

        // æª”æ¡ˆä¸Šå‚³è™•ç†
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // é¡¯ç¤ºæª”æ¡ˆè³‡è¨Š
            displayFileInfo(file);

            // æ ¹æ“šæª”æ¡ˆé¡å‹é€²è¡Œè§£æ
            const fileExtension = file.name.split('.').pop().toLowerCase();
            
            if (fileExtension === 'csv') {
                parseCSVFile(file);
            } else if (fileExtension === 'xls' || fileExtension === 'xlsx') {
                parseExcelFile(file);
            } else {
                alert('ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼ï¼Œè«‹é¸æ“‡ CSVã€XLS æˆ– XLSX æª”æ¡ˆ');
                return;
            }
        }

        // é¡¯ç¤ºæª”æ¡ˆè³‡è¨Š
        function displayFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileDetails = document.getElementById('fileDetails');
            
            fileName.textContent = file.name;
            fileDetails.textContent = `æª”æ¡ˆå¤§å°: ${(file.size / 1024).toFixed(2)} KB | æª”æ¡ˆé¡å‹: ${file.type || 'æœªçŸ¥'}`;
            fileInfo.classList.add('show');
        }

        // è§£æCSVæª”æ¡ˆ
        function parseCSVFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                const lines = csv.split('\n');
                const students = [];
                
                lines.forEach((line, index) => {
                    if (line.trim()) {
                        const columns = line.split(',');
                        const studentName = columns[0].trim().replace(/"/g, ''); // ç§»é™¤å¯èƒ½çš„å¼•è™Ÿ
                        if (studentName && studentName !== '' && index < 100) { // é™åˆ¶æœ€å¤š100å€‹å­¸ç”Ÿ
                            students.push(studentName);
                        }
                    }
                });
                
                if (students.length > 0) {
                    loadStudentList(students);
                } else {
                    alert('æœªåœ¨æª”æ¡ˆä¸­æ‰¾åˆ°æœ‰æ•ˆçš„å­¸ç”Ÿå§“å');
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        // è§£æExcelæª”æ¡ˆ
        function parseExcelFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // è®€å–ç¬¬ä¸€å€‹å·¥ä½œè¡¨
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // è½‰æ›ç‚ºJSONæ ¼å¼
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    const students = [];
                    jsonData.forEach((row, index) => {
                        if (row[0] && typeof row[0] === 'string' && row[0].trim() !== '' && index < 100) {
                            students.push(row[0].trim());
                        }
                    });
                    
                    if (students.length > 0) {
                        loadStudentList(students);
                    } else {
                        alert('æœªåœ¨æª”æ¡ˆä¸­æ‰¾åˆ°æœ‰æ•ˆçš„å­¸ç”Ÿå§“å');
                    }
                } catch (error) {
                    console.error('è§£æExcelæª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                    alert('è§£ææª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¢ºèªæª”æ¡ˆæ ¼å¼æ­£ç¢º');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // è¼‰å…¥å­¸ç”Ÿåå–®
        function loadStudentList(students) {
            studentList = [...new Set(students)]; // å»é™¤é‡è¤‡é …ç›®
            studentScores = {};
            studentExamples = {};
            studentComments = {};
            currentStudentIndex = -1;
            currentGeneratedComment = '';
            currentCommentType = '';
            
            // åˆå§‹åŒ–æ‰€æœ‰å­¸ç”Ÿçš„è©•åˆ†è³‡æ–™
            studentList.forEach(student => {
                studentScores[student] = {};
                studentExamples[student] = {};
                studentComments[student] = null;
            });
            
            displayStudentList();
            
            // æ¸…é™¤æœå°‹è¼¸å…¥æ¡†
            document.getElementById('studentSearch').value = '';
            
            // é¡¯ç¤ºå­¸ç”Ÿåˆ—è¡¨å€åŸŸ
            document.getElementById('studentListSection').classList.add('show');
            
            // æ»¾å‹•åˆ°å­¸ç”Ÿåˆ—è¡¨
            document.getElementById('studentListSection').scrollIntoView({ behavior: 'smooth' });
            
            alert(`æˆåŠŸåŒ¯å…¥ ${studentList.length} ä½å­¸ç”Ÿçš„åå–®ï¼`);
        }

        // é¡¯ç¤ºå­¸ç”Ÿåˆ—è¡¨
        function displayStudentList() {
            const studentSelector = document.getElementById('studentSelector');
            const studentCount = document.getElementById('studentCount');
            
            studentCount.textContent = `å…± ${studentList.length} ä½å­¸ç”Ÿ`;
            
            // æ¸…ç©ºä¸¦é‡æ–°å¡«å……ä¸‹æ‹‰é¸å–®
            studentSelector.innerHTML = '<option value="">-- è«‹é¸æ“‡å­¸ç”Ÿ --</option>';
            
            studentList.forEach((student, index) => {
                const option = document.createElement('option');
                option.value = index;
                
                const isScored = Object.keys(studentScores[student]).length > 0;
                const hasComment = studentComments[student] !== null;
                const isActive = index === currentStudentIndex;
                
                let statusIcon = '';
                let statusText = '';
                let dataStatus = '';
                
                if (isActive) {
                    statusIcon = 'ğŸ”µ';
                    statusText = 'è©•åˆ†ä¸­';
                    dataStatus = 'active';
                } else if (hasComment) {
                    statusIcon = 'ğŸŸ¢';
                    statusText = 'å·²å®Œæˆ';
                    dataStatus = 'completed';
                } else if (isScored) {
                    statusIcon = 'ğŸŸ¡';
                    statusText = 'å·²è©•åˆ†';
                    dataStatus = 'rated';
                } else {
                    statusIcon = 'ğŸ”´';
                    statusText = 'æœªè©•åˆ†';
                    dataStatus = 'unrated';
                }
                
                option.textContent = `${statusIcon} ${student} (${statusText})`;
                option.setAttribute('data-status', dataStatus);
                option.setAttribute('data-name', student.toLowerCase());
                
                if (isActive) {
                    option.selected = true;
                }
                
                studentSelector.appendChild(option);
            });
            
            // æ›´æ–°çµ±è¨ˆè³‡è¨Š
            updateStudentStats();
        }

        // æ›´æ–°å­¸ç”Ÿçµ±è¨ˆè³‡è¨Š
        function updateStudentStats() {
            let unratedCount = 0;
            let ratedCount = 0;
            let completedCount = 0;
            
            studentList.forEach(student => {
                const isScored = Object.keys(studentScores[student]).length > 0;
                const hasComment = studentComments[student] !== null;
                
                if (hasComment) {
                    completedCount++;
                } else if (isScored) {
                    ratedCount++;
                } else {
                    unratedCount++;
                }
            });
            
            const completionRate = studentList.length > 0 ? 
                Math.round((completedCount / studentList.length) * 100) : 0;
            
            document.getElementById('unratedCount').textContent = unratedCount;
            document.getElementById('ratedCount').textContent = ratedCount;
            document.getElementById('completedCount').textContent = completedCount;
            document.getElementById('completionRate').textContent = `${completionRate}%`;
        }

        // è™•ç†ä¸‹æ‹‰é¸å–®å­¸ç”Ÿé¸æ“‡
        function handleStudentSelection(selectedValue) {
            if (selectedValue === '') {
                return;
            }
            
            const index = parseInt(selectedValue);
            selectStudent(index);
        }

        // è™•ç†æœå°‹è¼¸å…¥æ¡†éµç›¤äº‹ä»¶
        function handleSearchKeydown(event) {
            if (event.key === 'Enter') {
                const searchTerm = event.target.value.toLowerCase().trim();
                if (searchTerm) {
                    // å°‹æ‰¾å®Œå…¨åŒ¹é…çš„å­¸ç”Ÿ
                    const exactMatch = studentList.find(student => 
                        student.toLowerCase() === searchTerm
                    );
                    
                    if (exactMatch) {
                        const index = studentList.indexOf(exactMatch);
                        selectStudent(index);
                        event.target.value = '';
                        filterStudents('');
                    } else {
                        // å°‹æ‰¾éƒ¨åˆ†åŒ¹é…çš„ç¬¬ä¸€å€‹å­¸ç”Ÿ
                        const partialMatch = studentList.find(student => 
                            student.toLowerCase().includes(searchTerm)
                        );
                        
                        if (partialMatch) {
                            const index = studentList.indexOf(partialMatch);
                            selectStudent(index);
                            event.target.value = '';
                            filterStudents('');
                        }
                    }
                }
            } else if (event.key === 'Escape') {
                event.target.value = '';
                filterStudents('');
                event.target.blur();
            }
        }

        // å­¸ç”Ÿæœå°‹éæ¿¾
        function filterStudents(searchTerm) {
            const studentSelector = document.getElementById('studentSelector');
            const options = studentSelector.querySelectorAll('option');
            
            searchTerm = searchTerm.toLowerCase().trim();
            
            options.forEach(option => {
                if (option.value === '') {
                    option.style.display = 'block';
                    return;
                }
                
                const studentName = option.getAttribute('data-name');
                if (studentName && studentName.includes(searchTerm)) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });
            
            // å¦‚æœæœå°‹çµæœåªæœ‰ä¸€å€‹å­¸ç”Ÿï¼Œè‡ªå‹•é¸æ“‡
            const visibleOptions = Array.from(options).filter(option => 
                option.value !== '' && option.style.display !== 'none'
            );
            
            if (visibleOptions.length === 1 && searchTerm.length > 0) {
                const exactMatch = visibleOptions.find(option => 
                    option.getAttribute('data-name') === searchTerm
                );
                if (exactMatch) {
                    studentSelector.value = exactMatch.value;
                    handleStudentSelection(exactMatch.value);
                    document.getElementById('studentSearch').value = '';
                    filterStudents(''); // æ¸…é™¤ç¯©é¸ï¼Œé¡¯ç¤ºæ‰€æœ‰é¸é …
                }
            }
        }

        // é¸æ“‡å­¸ç”Ÿé€²è¡Œè©•åˆ†
        function selectStudent(index) {
            if (index < 0 || index >= studentList.length) return;
            
            // å„²å­˜ç•¶å‰å­¸ç”Ÿçš„è©•åˆ†è³‡æ–™
            if (currentStudentIndex >= 0) {
                saveCurrentStudentData();
            }
            
            // åˆ‡æ›åˆ°æ–°å­¸ç”Ÿ
            currentStudentIndex = index;
            const studentName = studentList[index];
            
            // æ›´æ–°ç•Œé¢
            document.getElementById('studentName').value = studentName;
            document.getElementById('currentStudentName').textContent = studentName;
            document.getElementById('currentStudentIndicator').style.display = 'block';
            
            // è¼‰å…¥å­¸ç”Ÿçš„è©•åˆ†è³‡æ–™
            loadStudentData(studentName);
            
            // æ›´æ–°å­¸ç”Ÿåˆ—è¡¨é¡¯ç¤º
            displayStudentList();
            
            // æ›´æ–°ä¸‹æ‹‰é¸å–®é¸æ“‡
            document.getElementById('studentSelector').value = index;
            
            // æ»¾å‹•åˆ°è©•åˆ†å€åŸŸ
            document.querySelector('.input-section').scrollIntoView({ behavior: 'smooth' });
        }

        // å„²å­˜ç•¶å‰å­¸ç”Ÿçš„è©•åˆ†è³‡æ–™
        function saveCurrentStudentData() {
            if (currentStudentIndex >= 0) {
                const studentName = studentList[currentStudentIndex];
                studentScores[studentName] = { ...scores };
                studentExamples[studentName] = { ...examples };
            }
        }

        // è¼‰å…¥å­¸ç”Ÿçš„è©•åˆ†è³‡æ–™
        function loadStudentData(studentName) {
            // æ¸…ç©ºç•¶å‰è©•åˆ†
            scores = {};
            examples = {};
            currentGeneratedComment = '';
            currentCommentType = '';
            
            // è¼‰å…¥å­¸ç”Ÿçš„è©•åˆ†è³‡æ–™
            if (studentScores[studentName]) {
                scores = { ...studentScores[studentName] };
            }
            if (studentExamples[studentName]) {
                examples = { ...studentExamples[studentName] };
            }
            
            // æ›´æ–°ç•Œé¢
            dimensions.forEach(dim => {
                const score = scores[dim.id];
                if (score !== undefined) {
                    setScore(dim.id, score);
                } else {
                    setScore(dim.id, null);
                }
                
                const example = examples[dim.id] || '';
                document.getElementById(`example-${dim.id}`).value = example;
            });
            
            // è¼‰å…¥å·²å„²å­˜çš„è©•èª
            loadSavedComment(studentName);
        }

        // è¼‰å…¥å·²å„²å­˜çš„è©•èª
        function loadSavedComment(studentName) {
            const savedComment = studentComments[studentName];
            const resultSection = document.getElementById('resultSection');
            const commentStatus = document.getElementById('commentStatus');
            
            if (savedComment) {
                // é¡¯ç¤ºå·²å„²å­˜çš„è©•èª
                document.getElementById('commentText').textContent = savedComment.content;
                
                // é¡¯ç¤ºè©•èªç‹€æ…‹
                updateCommentStatus('saved', savedComment);
                
                // é¡¯ç¤ºçµæœå€åŸŸ
                if (savedComment.type === 'idioms') {
                    document.getElementById('regenerateIdiomBtn').style.display = 'inline-block';
                    document.querySelector('.radar-chart-section').style.display = 'none';
                } else {
                    document.getElementById('regenerateIdiomBtn').style.display = 'none';
                    document.querySelector('.radar-chart-section').style.display = 'block';
                    generateRadarChart();
                }
                
                resultSection.classList.add('show');
            } else {
                // éš±è—çµæœå€åŸŸ
                resultSection.classList.remove('show');
                commentStatus.style.display = 'none';
            }
        }

        // æ›´æ–°è©•èªç‹€æ…‹é¡¯ç¤º
        function updateCommentStatus(status, commentData = null) {
            const commentStatus = document.getElementById('commentStatus');
            const commentStatusText = document.getElementById('commentStatusText');
            const commentMetadata = document.getElementById('commentMetadata');
            const saveBtn = document.getElementById('saveCommentBtn');
            
            commentStatus.style.display = 'block';
            commentStatus.className = 'comment-status ' + status;
            
            if (status === 'saved' && commentData) {
                commentStatusText.textContent = 'è©•èªå·²å„²å­˜';
                const typeText = commentData.type === 'idioms' ? 'å››å­—æˆèªç‰ˆæœ¬' : 'å…­å‘åº¦è©•åˆ†ç‰ˆæœ¬';
                const timeText = new Date(commentData.timestamp).toLocaleString('zh-TW');
                commentMetadata.textContent = `é¡å‹ï¼š${typeText} | å„²å­˜æ™‚é–“ï¼š${timeText}`;
                saveBtn.disabled = true;
                saveBtn.textContent = 'å·²å„²å­˜';
            } else if (status === 'unsaved') {
                commentStatusText.textContent = 'è©•èªå·²ç”Ÿæˆï¼Œä½†å°šæœªå„²å­˜';
                commentMetadata.textContent = 'è«‹é»æ“Šã€Œå„²å­˜è©•èªã€æŒ‰éˆ•ä»¥ä¿å­˜åˆ°å­¸ç”Ÿè³‡æ–™ä¸­';
                saveBtn.disabled = false;
                saveBtn.textContent = 'å„²å­˜è©•èª';
            }
        }

        // å„²å­˜ç•¶å‰è©•èª
        function saveCurrentComment() {
            if (!currentGeneratedComment || !currentCommentType) {
                alert('æ²’æœ‰å¯å„²å­˜çš„è©•èª');
                return;
            }
            
            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName) {
                alert('è«‹å…ˆé¸æ“‡æˆ–è¼¸å…¥å­¸ç”Ÿå§“å');
                return;
            }
            
            // å¦‚æœæ˜¯æ‰¹é‡è©•åˆ†æ¨¡å¼ï¼Œç¢ºä¿å­¸ç”Ÿåœ¨åˆ—è¡¨ä¸­
            if (studentList.length > 0 && !studentList.includes(studentName)) {
                alert('è©²å­¸ç”Ÿä¸åœ¨å·²åŒ¯å…¥çš„åå–®ä¸­');
                return;
            }
            
            // å„²å­˜è©•èª
            const commentData = {
                content: currentGeneratedComment,
                type: currentCommentType,
                timestamp: new Date().toISOString(),
                studentName: studentName
            };
            
            // åˆå§‹åŒ–å­¸ç”Ÿè³‡æ–™ï¼ˆå¦‚æœæ˜¯å–®ç¨è©•åˆ†ï¼‰
            if (studentList.length === 0) {
                if (!studentComments[studentName]) {
                    studentComments[studentName] = null;
                }
            }
            
            studentComments[studentName] = commentData;
            
            // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
            updateCommentStatus('saved', commentData);
            
            // æ›´æ–°å­¸ç”Ÿåˆ—è¡¨é¡¯ç¤ºï¼ˆå¦‚æœåœ¨æ‰¹é‡æ¨¡å¼ï¼‰
            if (studentList.length > 0) {
                displayStudentList();
            } else {
                // å–®ç¨è©•åˆ†æ¨¡å¼ä¹Ÿæ›´æ–°çµ±è¨ˆ
                updateStudentStats();
            }
            
            alert('è©•èªå·²æˆåŠŸå„²å­˜ï¼');
        }

        // ç‰ˆæœ¬åˆ‡æ›åŠŸèƒ½
        function switchVersion() {
            const versionRadios = document.querySelectorAll('input[name="commentVersion"]');
            const scoringSection = document.getElementById('scoringSection');
            const idiomsSection = document.getElementById('idiomsSection');
            
            versionRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'scoring') {
                        scoringSection.style.display = 'block';
                        idiomsSection.style.display = 'none';
                    } else if (this.value === 'idioms') {
                        scoringSection.style.display = 'none';
                        idiomsSection.style.display = 'block';
                    }
                });
            });
        }

        // ç”Ÿæˆå››å­—æˆèªè©•èª
        function generateIdiomComment() {
            // æ”¶é›†é¸ä¸­çš„é¡åˆ¥
            const selectedCategories = [];
            const checkboxes = document.querySelectorAll('#idiomsSection input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹è©•èªé¡åˆ¥');
                return;
            }
            
            selectedIdioms = [];
            
            checkboxes.forEach(checkbox => {
                const categoryItem = checkbox.closest('.category-item');
                const category = categoryItem.dataset.category;
                const subcategory = checkbox.dataset.subcategory;
                
                if (idiomData[category] && idiomData[category][subcategory]) {
                    const idioms = idiomData[category][subcategory];
                    const randomIdiom = idioms[Math.floor(Math.random() * idioms.length)];
                    selectedIdioms.push(randomIdiom);
                }
            });
            
            // ç”Ÿæˆæœ€çµ‚è©•èª
            const comment = generateFinalIdiomComment(selectedIdioms);
            
            // è¨­å®šç•¶å‰ç”Ÿæˆçš„è©•èª
            currentGeneratedComment = comment;
            currentCommentType = 'idioms';
            
            // é¡¯ç¤ºçµæœ
            document.getElementById('commentText').textContent = comment;
            
            // é¡¯ç¤ºæœªå„²å­˜ç‹€æ…‹
            updateCommentStatus('unsaved');
            
            // é¡¯ç¤ºé‡æ–°ç”ŸæˆæŒ‰éˆ•ï¼Œéš±è—é›·é”åœ–
            document.getElementById('regenerateIdiomBtn').style.display = 'inline-block';
            document.querySelector('.radar-chart-section').style.display = 'none';
            
            document.getElementById('resultSection').classList.add('show');
            
            // æ»¾å‹•åˆ°çµæœå€åŸŸ
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }

        // ç”Ÿæˆæœ€çµ‚çš„å››å­—æˆèªè©•èª
        function generateFinalIdiomComment(idioms) {
            if (idioms.length === 0) return '';
            
            // ç›´æ¥é¡¯ç¤ºé¸ä¸­çš„æˆèª
            return idioms.join('ã€');
        }

        // åˆ‡æ›æ‰¹é‡ç¸½è¦½é¡¯ç¤º
        function toggleBatchOverview() {
            const overviewSection = document.getElementById('batchOverviewSection');
            const isVisible = overviewSection.classList.contains('show');
            
            if (isVisible) {
                overviewSection.classList.remove('show');
            } else {
                // å„²å­˜ç•¶å‰å­¸ç”Ÿçš„è©•åˆ†è³‡æ–™
                saveCurrentStudentData();
                
                // æ›´æ–°ç¸½è¦½è¡¨æ ¼
                updateBatchOverview();
                
                // é¡¯ç¤ºç¸½è¦½
                overviewSection.classList.add('show');
                overviewSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // æ›´æ–°æ‰¹é‡ç¸½è¦½è¡¨æ ¼
        function updateBatchOverview() {
            const tableBody = document.querySelector('#overviewTable tbody');
            tableBody.innerHTML = '';
            
            studentList.forEach((student, index) => {
                const row = document.createElement('tr');
                const studentData = studentScores[student] || {};
                const commentData = studentComments[student];
                
                // è¨ˆç®—å·²è©•åˆ†çš„å‘åº¦æ•¸é‡
                const scoredDimensions = Object.keys(studentData).length;
                const totalDimensions = dimensions.length;
                
                // è©•èªç‹€æ…‹
                let commentStatus = '-';
                let commentType = '-';
                if (commentData) {
                    commentStatus = 'å·²å„²å­˜';
                    commentType = commentData.type === 'idioms' ? 'å››å­—æˆèª' : 'å…­å‘åº¦è©•åˆ†';
                } else if (scoredDimensions > 0) {
                    commentStatus = 'å¯ç”Ÿæˆ';
                }
                
                row.innerHTML = `
                    <td class="student-name-cell" onclick="selectStudent(${index})">${student}</td>
                    <td class="score-cell ${studentData.attitude !== undefined ? 'scored' : 'unscored'}">${studentData.attitude !== undefined ? studentData.attitude : '-'}</td>
                    <td class="score-cell ${studentData.exam !== undefined ? 'scored' : 'unscored'}">${studentData.exam !== undefined ? studentData.exam : '-'}</td>
                    <td class="score-cell ${studentData.notes !== undefined ? 'scored' : 'unscored'}">${studentData.notes !== undefined ? studentData.notes : '-'}</td>
                    <td class="score-cell ${studentData.peer !== undefined ? 'scored' : 'unscored'}">${studentData.peer !== undefined ? studentData.peer : '-'}</td>
                    <td class="score-cell ${studentData.selflearn !== undefined ? 'scored' : 'unscored'}">${studentData.selflearn !== undefined ? studentData.selflearn : '-'}</td>
                    <td class="score-cell ${studentData.attendance !== undefined ? 'scored' : 'unscored'}">${studentData.attendance !== undefined ? studentData.attendance : '-'}</td>
                    <td class="score-cell ${commentData ? 'scored' : 'unscored'}">${commentStatus}</td>
                    <td class="score-cell ${commentData ? 'scored' : 'unscored'}">${commentType}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // åŒ¯å‡ºçµæœ
        function exportResults() {
            if (studentList.length === 0) {
                alert('æ²’æœ‰å­¸ç”Ÿè³‡æ–™å¯ä»¥åŒ¯å‡º');
                return;
            }
            
            // å„²å­˜ç•¶å‰å­¸ç”Ÿçš„è©•åˆ†è³‡æ–™
            saveCurrentStudentData();
            
            // æº–å‚™åŒ¯å‡ºè³‡æ–™
            const exportData = [];
            
            // æ·»åŠ æ¨™é¡Œè¡Œ
            const headers = ['å­¸ç”Ÿå§“å', 'ä¸Šèª²æ…‹åº¦', 'è€ƒè©¦åˆ†æ•¸', 'ç­†è¨˜åˆ†æ•¸', 'åŒå„•é—œä¿‚', 'è‡ªä¸»å­¸ç¿’', 'ç”Ÿæ´»å¸¸è¦', 'å·²è©•åˆ†å‘åº¦', 'è©•èªé¡å‹', 'å„²å­˜çš„è©•èª', 'ç”Ÿæˆæ™‚é–“'];
            exportData.push(headers);
            
            // æ·»åŠ å­¸ç”Ÿè³‡æ–™
            studentList.forEach(student => {
                const studentData = studentScores[student] || {};
                const commentData = studentComments[student];
                
                const scoredDimensions = Object.keys(studentData).length;
                const totalDimensions = dimensions.length;
                
                // ä½¿ç”¨å·²å„²å­˜çš„è©•èªï¼Œå¦‚æœæ²’æœ‰å‰‡ç‚ºç©º
                let comment = '';
                let commentType = '';
                let saveTime = '';
                
                if (commentData) {
                    comment = commentData.content;
                    commentType = commentData.type === 'idioms' ? 'å››å­—æˆèªç‰ˆæœ¬' : 'å…­å‘åº¦è©•åˆ†ç‰ˆæœ¬';
                    saveTime = new Date(commentData.timestamp).toLocaleString('zh-TW');
                }
                
                const row = [
                    student,
                    studentData.attitude !== undefined ? studentData.attitude : '',
                    studentData.exam !== undefined ? studentData.exam : '',
                    studentData.notes !== undefined ? studentData.notes : '',
                    studentData.peer !== undefined ? studentData.peer : '',
                    studentData.selflearn !== undefined ? studentData.selflearn : '',
                    studentData.attendance !== undefined ? studentData.attendance : '',
                    `${scoredDimensions}/${totalDimensions}`,
                    commentType,
                    comment,
                    saveTime
                ];
                
                exportData.push(row);
            });
            
            // è½‰æ›ç‚ºCSVæ ¼å¼ä¸¦ä¸‹è¼‰
            downloadCSV(exportData, 'å­¸ç”Ÿè©•åˆ†çµæœ.csv');
        }

        // ç”Ÿæˆå­¸ç”Ÿè©•èª
        function generateStudentComment(studentName, studentData, studentExampleData) {
            if (Object.keys(studentData).length === 0) return '';
            
            // æ¨¡æ“¬ç”Ÿæˆè©•èªçš„éç¨‹
            const selectedTone = 'encouraging'; // é è¨­ä½¿ç”¨é¼“å‹µèªæ°£
            const selectedStyle = 'style1'; // é è¨­ä½¿ç”¨é¢¨æ ¼ä¸€
            
            // å°‡æœ‰åˆ†æ•¸çš„å‘åº¦æŒ‰åˆ†æ•¸é«˜ä½æ’åº
            const sortedDimensions = Object.entries(studentData)
                .map(([dimId, score]) => {
                    const dim = dimensions.find(d => d.id === dimId);
                    let comment = dim.comments[selectedTone][score];
                    
                    // è™•ç†å…·é«”äº‹ä¾‹çš„æ’å…¥
                    if (studentExampleData[dimId]) {
                        comment = comment.replace('{EXAMPLE}', `ï¼Œå¦‚${studentExampleData[dimId]}`);
                    } else {
                        comment = comment.replace('{EXAMPLE}', '');
                    }
                    
                    return {
                        id: dimId,
                        name: dim.name,
                        score: score,
                        comment: comment
                    };
                })
                .sort((a, b) => b.score - a.score);
            
            // ä½¿ç”¨é¢¨æ ¼ä¸€ç”Ÿæˆè©•èª
            return generateStyle1(studentName, sortedDimensions, selectedTone);
        }

        // ä¸‹è¼‰CSVæª”æ¡ˆ
        function downloadCSV(data, filename) {
            const csvContent = data.map(row => 
                row.map(cell => `"${cell}"`).join(',')
            ).join('\n');
            
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('è©•åˆ†çµæœå·²æˆåŠŸåŒ¯å‡ºï¼');
        }

        // é‡æ–°ç”Ÿæˆæˆèªï¼ˆä¿æŒç›¸åŒé¡åˆ¥ï¼Œä½†éš¨æ©Ÿé¸æ“‡ä¸åŒæˆèªï¼‰
        function regenerateIdioms() {
            const checkboxes = document.querySelectorAll('#idiomsSection input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert('è«‹å…ˆé¸æ“‡è©•èªé¡åˆ¥');
                return;
            }
            
            generateIdiomComment();
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initializeEvaluationItems();
            switchVersion();
            setupDragAndDrop();
            
            // ç‚ºæ¯å€‹å‘åº¦è¨­å®šé è¨­æœªè©•åˆ†ç‹€æ…‹
            dimensions.forEach(dim => {
                setScore(dim.id, null);
                setExample(dim.id, '');
            });
        });
    </script>
</body>
</html>